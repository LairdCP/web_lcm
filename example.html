
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
		<meta name="description" content="">
		<meta name="author" content="">

		<title>WebLCM Example</title>

		<!-- Bootstrap core CSS -->
		<link href="assets/css/bootstrap.min.css" rel="stylesheet">

		<!-- Custom styles for this template -->
		<link href="assets/css/dashboard.css" rel="stylesheet">
		<!-- https://github.com/seiyria/bootstrap-slider/blob/master/LICENSE.md -->
		<link href="assets/css/bootstrap-slider.min.css" rel="stylesheet">

		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/bootstrap.min.js"></script>
		<!-- https://github.com/seiyria/bootstrap-slider/blob/master/LICENSE.md -->
		<script src="assets/js/bootstrap-slider.min.js"></script>
		<script src="assets/js/button-adjuster.js"></script>
		<script>
		var intervalId;
		clickStatusPage();

		function SDCERRtoString(SDCERR){
			$("#returnData").removeClass();
			switch(parseInt(SDCERR)) {
				case 0: //SDCERR_SUCCESS
					$("#returnData").addClass("alert alert-success");
					$("#returnData").html("Success");
					break;
				case 1: //SDCERR_FAIL
					$("#returnData").addClass("alert alert-danger");
					$("#returnData").html("Failure");
					break;
				case 2: //SDCERR_INVALID_NAME
					$("#returnData").addClass("alert alert-danger");
					$("#returnData").html("Invalid Name");
					break;
				case 3: //SDCERR_INVALID_CONFIG
					$("#returnData").addClass("alert alert-danger");
					$("#returnData").html("Invalid Config");
					break;
				case 4: //SDCERR_INVALID_DELETE
					$("#returnData").addClass("alert alert-danger");
					$("#returnData").html("Invalid Delete");
					break;
				case 5: //SDCERR_POWERCYCLE_REQUIRED
					$("#returnData").addClass("alert alert-info");
					$("#returnData").html("Failure");
					break;
				case 6: //SDCERR_INVALID_PARAMETER
					$("#returnData").addClass("alert alert-danger");
					$("#returnData").html("Invalid Parameter");
					break;
				case 7: //SDCERR_INVALID_EAP_TYPE
					$("#returnData").addClass("alert alert-danger");
					$("#returnData").html("Invalid EAP TYPE");
					break;
				case 8: //SDCERR_INVALID_WEP_TYPE
					$("#returnData").addClass("alert alert-danger");
					$("#returnData").html("Invalid WEP TYPE");
					break;
				case 9: //SDCERR_INVALID_FILE
					$("#returnData").addClass("alert alert-danger");
					$("#returnData").html("Invalid File");
					break;
				case 10: //SDCERR_INSUFFICIENT_MEMORY
					$("#returnData").addClass("alert alert-danger");
					$("#returnData").html("Insufficient Memory");
					break;
				case 11: //SDCERR_NOT_IMPLEMENTED
					$("#returnData").addClass("alert alert-danger");
					$("#returnData").html("Not Implemented");
					break;
				case 12: //SDCERR_NO_HARDWARE
					$("#returnData").addClass("alert alert-danger");
					$("#returnData").html("No Hardware");
					break;
				case 13: //SDCERR_INVALID_VALUE
					$("#returnData").addClass("alert alert-danger");
					$("#returnData").html("Invalid Value");
					break;
				default:
					$("#returnData").addClass("alert alert-danger");
					$("#returnData").html("Unknown Data");
			}
		}

		function CustomErrMsg(message){
			$("#returnData").removeClass();
			$("#returnData").addClass("alert alert-danger");
			$("#returnData").html(message);
		}

		function CARDSTATEtoString(CARDSTATE){
			switch(CARDSTATE) {
				case 0: //CARDSTATE_NOT_INSERTED
					return "Not Inserted";
					break;
				case 1: //CARDSTATE_NOT_ASSOCIATED
					return "Not Associated";
					break;
				case 2: //CARDSTATE_ASSOCIATED
					return "Associated";
					break;
				case 3: //CARDSTATE_AUTHENTICATED
					return "Authenticated";
					break;
				case 4: //CARDSTATE_FCCTEST
					return "FCC Test";
					break;
				case 5: //CARDSTATE_NOT_SDC
					return "Not Laird";
					break;
				case 6: //CARDSTATE_DISABLED
					return "Disabled";
					break;
				case 7: //CARDSTATE_ERROR
					return "Error";
					break;
				case 8: //CARDSTATE_AP_MODE
					return "AP Mode";
					break;
				default:
					return "Unknown card state";
			}
		}

		function onChangeSubmit(){
			$("#submitButton").removeClass("disabled");
		}

		function onChangePowersave(){
			var powerSave = parseInt(document.getElementById("powerSave").value);
			switch (powerSave){
				case 0:
				case 1:
					$("#pspDelayDisplay").addClass("hidden");
					break;
				case 2:
					$("#pspDelayDisplay").removeClass("hidden");
					break;
				default:
					$("#pspDelayDisplay").removeClass("hidden");
					break;
			}
		}

		function onChangeSecurity(){
			var wepType = parseInt(document.getElementById("wepType").value);
			var eapType = parseInt(document.getElementById("eapType").value);
			function clearCredsDisplay(){
				$("#eapTypeDisplay").addClass("hidden");
				$("#wepIndexDisplay").addClass("hidden");
				$("#wepTypeOnDisplay").addClass("hidden");
				$("#pskDisplay").addClass("hidden");
				$("#userNameDisplay").addClass("hidden");
				$("#passWordDisplay").addClass("hidden");
				$("#userCertDisplay").addClass("hidden");
				$("#userCertPasswordDisplay").addClass("hidden");
				$("#CACertDisplay").addClass("hidden");
				$("#PACFilenameDisplay").addClass("hidden");
				$("#PACPasswordDisplay").addClass("hidden");
			}
			function displayProperEAPCreds(){
				$("#eapTypeDisplay").removeClass("hidden");
				$("#userNameDisplay").removeClass("hidden");
				if (!(eapType == 5 || eapType == 7)){
					$("#passWordDisplay").removeClass("hidden");
				} else {
					$("#userCertDisplay").removeClass("hidden");
					$("#userCertPasswordDisplay").removeClass("hidden");
				}
				if (eapType > 2 && eapType < 8){
					$("#CACertDisplay").removeClass("hidden");
				}
				if (eapType == 2){
					$("#PACFilenameDisplay").removeClass("hidden");
					$("#PACPasswordDisplay").removeClass("hidden");
				}
			}
			switch (wepType){
				case 0:
					clearCredsDisplay();
					break;
				case 1:
					clearCredsDisplay();
					$("#wepIndexDisplay").removeClass("hidden");
					$("#wepTypeOnDisplay").removeClass("hidden");
					break;
				case 2:
					clearCredsDisplay();
					displayProperEAPCreds();
					break;
				case 3:
					clearCredsDisplay();
					$("#pskDisplay").removeClass("hidden");
					break;
				case 4:
					clearCredsDisplay();
					displayProperEAPCreds();
					break;
				case 5:
					clearCredsDisplay();
					$("#pskDisplay").removeClass("hidden");
					break;
				case 6:
				case 7:
				case 8:
				case 9:
				case 10:
					clearCredsDisplay();
					displayProperEAPCreds();
					break;
				case 11:
					clearCredsDisplay();
					$("#pskDisplay").removeClass("hidden");
					break;
				case 12:
					clearCredsDisplay();
					displayProperEAPCreds();
					break;
				default:
					break;
			}
		}

		function updateStatus(){
			var getStatusJSON = $.getJSON( "php/status.php", function( data ) {
				var rssi = data.rssi;
				var rssiMeter = rssi + 120;
				$('#cardState').html(CARDSTATEtoString(data.cardState));
				$('#configName').html(data.configName);
				$('#ssid').html(data.ssid);
				$('#channel').html(data.channel);
				$('#rssi').html(rssi);
				$('#clientName').html(data.clientName);
				$('#client_MAC').html(data.client_MAC);
				$('#client_IP').html(data.client_IP);
				$('#APName').html(data.APName);
				$('#AP_MAC').html(data.AP_MAC);
				$('#AP_IP').html(data.AP_IP);
				$('#bitRate').html(data.bitRate);
				$('#txPower').html(data.txPower);
				$('#beaconPeriod').html(data.beaconPeriod);
				$('#DTIM').html(data.DTIM);

				$("#progressbar").removeClass("progress-bar-danger progress-bar-warning progress-bar-success");
				var rssiWidth = rssiMeter.toString().concat("%");
				if (rssi == 0){ //Not connected
					$("#progressbar").addClass("progress-bar-danger");
					$("#progressbar").css('width',rssiWidth);
				} else if (rssi < -90){ //red
					$("#progressbar").addClass("progress-bar-danger");
					$("#progressbar").css('width',rssiWidth);
				} else if (rssi < -70){ //yellow
					$("#progressbar").addClass("progress-bar-warning");
					$("#progressbar").css('width',rssiWidth);
				} else { //green
					$("#progressbar").addClass("progress-bar-success");
					$("#progressbar").css('width',rssiWidth);
				}
			})
			.fail(function() {
				console.log("Failed to get data, retrying.");
				setIntervalUpdate(updateStatus);
			});
		}

		function setIntervalUpdate(functionName){
			if (!intervalId){
				intervalId = setInterval(functionName, 1000);
			} else {
				console.log("Interval already set");
			}
		}

		function clickStatusPage() {
			if (intervalId){
				console.log("Status already active");
			} else {
				$("li").removeClass("active");
				$("#LiStatus").addClass("active");
				$("#returnData").removeClass();
				$("#returnData").html("");
				$("#helpText").html("This page shows the current state of WiFi");
				$.ajax({
					url: "html/status.html",
					data: {},
					type: "GET",
					dataType: "html",
					success: function (data) {
						$('#main_section').html(data);
						setIntervalUpdate(updateStatus);
					},
					error: function (xhr, status) {
						if (intervalId){
							clearInterval(intervalId);
							intervalId = 0;
						}
						console.log("Error, too many requests");
					},
				});
			}
		}

		function submitProfile(retry){
			var profileData = {
				profileName: document.getElementById("profileName").value,
				SSID: document.getElementById("SSID").value,
				clientName: document.getElementById("clientName").value,
				txPower: parseInt($('#txSlider').val()),
				authType: parseInt(document.getElementById("authType").value),
				eapType: parseInt(document.getElementById("eapType").value),
				wepType: parseInt(document.getElementById("wepType").value),
				radioMode: parseInt(document.getElementById("radioMode").value),
				powerSave: parseInt(document.getElementById("powerSave").value),
				pspDelay: parseInt($('#pspDelaySlider').val()),
				wepIndex: parseInt(document.getElementById("wepIndex").value),
				index1: document.getElementById("index1").value,
				index2: document.getElementById("index2").value,
				index3: document.getElementById("index3").value,
				index4: document.getElementById("index4").value,
				psk: document.getElementById("psk").value,
				userName: document.getElementById("userName").value,
				passWord: document.getElementById("passWord").value,
				userCert: document.getElementById("userCert").value,
				userCertPassword: document.getElementById("userCertPassword").value,
				CACert: document.getElementById("CACert").value,
				PACFilename: document.getElementById("PACFilename").value,
				PACPassword: document.getElementById("PACPassword").value,
			}
			console.log(profileData);
			$.ajax({
				url: "php/setProfile.php",
				type: "POST",
				data: JSON.stringify(profileData),
				contentType: "application/json",
			})
			.done(function( msg ) {
				console.log(msg);
				SDCERRtoString(msg.SDCERR);
				$("#submitButton").addClass("disabled");
			})
			.fail(function() {
				console.log("Failed to get profile data, retrying");
				if (retry < 5){
					retry++;
					submitProfile(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function SelectedIndex(sel, val) {
			for(var i = 0, j = sel.options.length; i < j; ++i) {
				if(sel.options[i].value == val) {
				sel.selectedIndex = i;
				break;
				}
			}
		}

		function updateGetProfilePage(profileName,retry){
			var data = {
					profileName: profileName,
				}
			$.ajax({
				url: "php/getProfile.php",
				type: "POST",
				data: JSON.stringify(data),
				contentType: "application/json",
			})
			.done(function( msg ) {
				console.log(msg);
				document.getElementById("profileName").value = msg.configName;
				document.getElementById("SSID").value = msg.SSID;
				document.getElementById("clientName").value = msg.clientName;
				$('#txSlider').slider('setValue', msg.txPower);
				document.getElementById("authType").selectedIndex =  msg.authType;
				//If index does not start at 0 and run contiguously we must check against options value
				SelectedIndex(document.getElementById("wepType"),msg.wepType);
				SelectedIndex(document.getElementById("eapType"),msg.eapType);
				SelectedIndex(document.getElementById("radioMode"),msg.radioMode);
				document.getElementById("powerSave").selectedIndex =  msg.powerSave;
				if (msg.powerSave == 2){
					$("#pspDelayDisplay").removeClass("hidden");
					$('#pspDelaySlider').slider('setValue', msg.pspDelay);
				}
				if (msg.wepType == 1){
					$("#wepIndexDisplay").removeClass("hidden");
					document.getElementById("wepIndex").selectedIndex =  msg.wepIndex - 1;
					$("#wepTypeOnDisplay").removeClass("hidden");
					document.getElementById("index1").value =  msg.WEPKey1;
					document.getElementById("index2").value =  msg.WEPKey2;
					document.getElementById("index3").value =  msg.WEPKey3;
					document.getElementById("index4").value =  msg.WEPKey4;
				} else if (msg.wepType == 3 || msg.wepType == 5 || msg.wepType == 11 || msg.wepType == 13){
					$("#pskDisplay").removeClass("hidden");
					document.getElementById("psk").value =  msg.PSK;
				} else if (msg.eapType >= 1){
					$("#eapTypeDisplay").removeClass("hidden");
					$("#userNameDisplay").removeClass("hidden");
					document.getElementById("userName").value =  msg.userName;
					if (!(msg.eapType == 5 || msg.eapType == 7)){
						$("#passWordDisplay").removeClass("hidden");
						document.getElementById("passWord").value =  msg.passWord;
					} else {
						$("#userCertDisplay").removeClass("hidden");
						document.getElementById("userCert").value =  msg.userCert;
						$("#userCertPasswordDisplay").removeClass("hidden");
						document.getElementById("userCertPassword").value =  msg.userCertPassword;
					}
					if (msg.eapType > 2 && msg.eapType < 8){
						$("#CACertDisplay").removeClass("hidden");
						document.getElementById("CACert").value =  msg.CACert;
					}
					if (msg.eapType == 2){
						$("#PACFilenameDisplay").removeClass("hidden");
						document.getElementById("PACFilename").value =  msg.PACFileName;
						$("#PACPasswordDisplay").removeClass("hidden");
						document.getElementById("PACPassword").value =  msg.PACPassword;
					}
				}
			})
			.fail(function() {
				console.log("Failed to get profile data, retrying");
				if (retry < 5){
					retry++;
					updateGetProfilePage(profileName,retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function selectedProfile(selectedProfile,retry){
			if(!selectedProfile){
				var selectedProfile = document.getElementById("profileSelect").value;
			}
			$.ajax({
				url: "html/getProfile.html",
				data: {},
				type: "GET",
				dataType: "html",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
					$('#main_section').html(data);
					$("#returnData").removeClass();
					$("#returnData").html("");
					$("#helpText").html("Adjust profile settings.");
				},
				error: function (xhr, status) {
					console.log("Error, couldn't get getProfile.html");
				},
			})
			.done(function( msg ) {
				console.log("Now try to get profile from PHP");
				updateGetProfilePage(selectedProfile,0);
				$('#txSlider').slider({
					formatter: function(value) {
						if (value != 0){
							return 'Current value: ' + value;
						} else {
							return 'Current value: Auto';
						}
					}
				});
				$('#pspDelaySlider').slider({
					formatter: function(value) {
						return 'Current value: ' + value;
					}
				});
			})
			.fail(function() {
				console.log("Failed to get get Profile, retrying");
				if (retry < 5){
					retry++;
					selectedProfile(selectedProfile,retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function updateSelectProfilePage(retry){
			$.ajax({
				url: "php/listProfile.php",
				type: "POST",
				contentType: "application/json",
			})
			.done(function( msg ) {
				console.log(msg);
				var x = document.getElementById("profileSelect");
				x.size = String(msg.NumConfigs);
				for (i = 0; i < msg.NumConfigs; i++) {
					var option = document.createElement("option");
					option.text = msg.profiles[i];
					x.add(option);
					if (msg.profiles[i] == msg.currentConfig){
						x.selectedIndex = i;
						option.id = "activeProfile";
						var helpText = document.getElementById("helpText").innerHTML;
						$("#helpText").html(helpText + " Profile " + msg.currentConfig + " is the active profile.");
					}
				}
				if (msg.autoProfiles){
					for (var profile in msg.autoProfiles){
						var table = document.getElementById("autoProfileTable");
						var row = table.insertRow(-1);
						var cell1 = row.insertCell(0);
						var cell2 = row.insertCell(1);
						var checkbox = document.createElement('input');
						cell1.innerHTML = profile;
						checkbox.type = "checkbox";
						checkbox.name = "autoProfile" + parseInt(row.rowIndex);
						checkbox.value = profile;
						if (msg.autoProfiles[profile] == true){
							checkbox.checked = true;
						}
						cell2.appendChild(checkbox);
					}
					$("#autoProfileDisplay").removeClass("hidden");
				}
			})
			.fail(function() {
				console.log("Failed to get profiles, retrying");
				if (retry < 5){
					retry++;
					updateSelectProfilePage(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function activateProfile(retry){
			var data = {
					profileName: document.getElementById("profileSelect").value,
			}
			console.log("Activating profile " + data.profileName);
			$.ajax({
				url: "php/activateProfile.php",
				type: "POST",
				data: JSON.stringify(data),
				contentType: "application/json",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
				},
				error: function (xhr, status) {
					console.log("Error, couldn't get activateProfile.php");
				},
			})
			.done(function( msg ) {
				console.log(msg);
				SDCERRtoString(msg.SDCERR);
			})
			.fail(function() {
				console.log("Failed to activate profile, retrying");
				if (retry < 5){
					retry++;
					activateProfile(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function renameProfile(retry){
			var profileSelect = document.getElementById("profileSelect");
			var selectedProfile = profileSelect.options[profileSelect.selectedIndex].text;
			var profileName = {
					currentName: selectedProfile,
					newName: document.getElementById("newProfileName").value,
			}
			$.ajax({
				url: "php/renameProfile.php",
				type: "POST",
				data: JSON.stringify(profileName),
				contentType: "application/json",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
				},
				error: function (xhr, status) {
					console.log("Error, couldn't get renameProfile.php");
				},
			})
			.done(function( msg ) {
				console.log(msg);
				SDCERRtoString(msg.SDCERR);
				if (document.getElementById("returnData").innerHTML == "Success"){
					for(var i = 0; i < profileSelect.options.length; i++) {
						if (profileName.currentName == profileSelect.options[i].text){
							profileSelect.options[i].text = profileName.newName;
						}
					}
					$("#newProfileNameDisplay").addClass("hidden");
				}
			})
			.fail(function() {
				console.log("Failed to rename profile, retrying");
				if (retry < 5){
					retry++;
					renameProfile(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function showRenameProfile(){
			$("#newProfileNameDisplay").removeClass("hidden");
		}

		function removeProfile(){
			var profileSelect = document.getElementById("profileSelect");
			var activeProfile = document.getElementById("activeProfile");
			var oldProfile = {
				profileName: profileSelect.value
			}
			if (oldProfile.profileName != activeProfile.text){
				$.ajax({
					url: "php/removeProfile.php",
					type: "POST",
					data: JSON.stringify(oldProfile),
					contentType: "application/json",
				})
				.done(function( msg ) {
					SDCERRtoString(msg.SDCERR);
					if (document.getElementById("returnData").innerHTML == "Success"){
						for(var i = 0; i < profileSelect.options.length; i++) {
							if (oldProfile.profileName == profileSelect.options[i].text){
								profileSelect.options.remove(i);
								profileSelect.size = profileSelect.size - 1;
							}
						}
					}
				});
			} else {
				CustomErrMsg("Cant delete active profile");
			}
		};

		function clickProfileEditPage(retry) {
			$.ajax({
				url: "html/selectProfile.html",
				data: {},
				type: "GET",
				dataType: "html",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
					$("li").removeClass("active");
					$("#submenuEdit").addClass("active");
					$('#main_section').html(data);
					$("#returnData").removeClass();
					$("#returnData").html("");
					$("#helpText").html("These are the current WiFi profiles.");
					setTimeout(updateSelectProfilePage(retry),1000);
				},
			})
			.fail(function() {
				console.log("Error, couldn't get selectProfile.html.. retrying");
				if (retry < 5){
					retry++;
					clickProfileEditPage(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function clickAddProfilePage(retry) {
			$.ajax({
				url: "html/addProfile.html",
				data: {},
				type: "GET",
				dataType: "html",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
					$('#main_section').html(data);
					$("#returnData").removeClass();
					$("#returnData").html("");
					$("li").removeClass("active");
					$("#submenuAdd").addClass("active");
					$("#helpText").html("Enter the name of the profile you would like to add.");
					$('#txSlider').slider({
						formatter: function(value) {
							if (value != 0){
								return 'Current value: ' + value;
							} else {
								return 'Current value: Auto';
							}
						}
					});
					$('#pspDelaySlider').slider({
						formatter: function(value) {
							return 'Current value: ' + value;
						}
					});
				},
			})
			.fail(function() {
				console.log("Error, couldn't get addProfile.html.. retrying");
				if (retry < 5){
					retry++;
					clickAddProfilePage(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function updateAddProfileSlider(){
			//https://github.com/seiyria/bootstrap-slider/issues/523
			setTimeout(function() {
				$('#pspDelaySlider').slider("relayout");
				$('#txSlider').slider("relayout");
			}, 500);
		}

		function addProfile(){
			if (profileName != ""){
				var newProfile = {
					profileName: document.getElementById("profileName").value,
					SSID: document.getElementById("SSID").value,
					clientName: document.getElementById("clientName").value,
					txPower: parseInt($('#txSlider').val()),
					authType: parseInt(document.getElementById("authType").value),
					eapType: parseInt(document.getElementById("eapType").value),
					wepType: parseInt(document.getElementById("wepType").value),
					radioMode: parseInt(document.getElementById("radioMode").value),
					powerSave: parseInt(document.getElementById("powerSave").value),
					pspDelay: parseInt($('#pspDelaySlider').val()),
					wepIndex: parseInt(document.getElementById("wepIndex").value),
					index1: document.getElementById("index1").value,
					index2: document.getElementById("index2").value,
					index3: document.getElementById("index3").value,
					index4: document.getElementById("index4").value,
					psk: document.getElementById("psk").value,
					userName: document.getElementById("userName").value,
					passWord: document.getElementById("passWord").value,
					userCert: document.getElementById("userCert").value,
					userCertPassword: document.getElementById("userCertPassword").value,
					CACert: document.getElementById("CACert").value,
					PACFilename: document.getElementById("PACFilename").value,
					PACPassword: document.getElementById("PACPassword").value,
				}
				console.log(newProfile);
				$.ajax({
					url: "php/addProfile.php",
					type: "POST",
					data: JSON.stringify(newProfile),
					contentType: "application/json",
				})
				.done(function( msg ) {
					console.log(msg);
					console.log(msg.SDCERR);
					SDCERRtoString(msg.SDCERR);
				});
			} else {
				console.log("Name is null");
			}
		};

		function getSupportedGlobals(retry){
			$.ajax({
				url: "php/supportedGlobals.php",
				type: "GET",
				contentType: "application/json",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
					console.log(data);
					for (var key in data) {
						if (data[key] != 0 && key != "SDCERR"){
							$("#" + key + "Display").removeClass("hidden");
						}
						$("#submitButton").removeClass("hidden");
					}
				},
			})
			.fail(function() {
				console.log("Error, couldn't get supportedGlobals.php.. retrying");
				if (retry < 5){
					retry++;
					getSupportedGlobals(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function isSlider(id){
			switch(id){
				case "BeaconMissTimeout":
				case "fragThreshold":
				case "probeDelay":
				case "roamPeriodms":
				case "roamTrigger":
				case "RTSThreshold":
				case "scanDFSTime":
					return true;
					break;
				default:
					return false
					break;
			}
		}

		function getGlobals(retry){
			$.ajax({
				url: "php/getGlobals.php",
				type: "POST",
				contentType: "application/json",
			})
			.done(function(msg) {
				if (intervalId){
					clearInterval(intervalId);
					intervalId = 0;
				}
				console.log(msg);
				for (var key in msg) {
					if (key != "SDCERR"){
						if (isSlider(key)){
							$("#" + key + "Slider").slider('setValue', msg[key]);
						} else{
							if (key != "suppInfo"){
								if (key == "aLRS"){
									for (var aChannel in msg[key]){
										document.getElementById("channel" + msg[key][aChannel]).checked = true;
									}
								}else if(key == "bLRS"){
									for (var bChannel in msg[key]){
										document.getElementById("channel" + msg[key][bChannel]).checked = true;
									}
								}else if(key == "fipsStatus"){
									switch (msg[key])
									{
										case 0: //FIPS_INACTIVE
											document.getElementById("fipsStatus").innerHTML = "FIPS disabled and inactive:";
											break;
										case 1: //FIPS_INACTIVE_ENABLED
											document.getElementById("fipsStatus").innerHTML =  "FIPS Mode inactive, enabled on next start:";
											break;
										case 2: //FIPS_ACTIVE_DISABLED
											document.getElementById("fipsStatus").innerHTML =  "FIPS Mode active, disabled on next start:";
											break;
										case 3: //FIPS_ACTIVE
											document.getElementById("fipsStatus").innerHTML =  "FIPS Mode enabled and active:";
											break;
										default:
											break;
									}
								}else{
									document.getElementById(key).value = msg[key];
								}
							}
						}
					}
				}
			})
			.fail(function() {
				console.log("Error, couldn't get getGlobals.php.. retrying");
				if (retry < 5){
					retry++;
					getGlobals(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function clickGlobalsPage(retry){
			$.ajax({
				url: "html/getGlobals.html",
				data: {},
				type: "GET",
				dataType: "html",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
					$('#main_section').html(data);
					$("#returnData").removeClass();
					$("#returnData").html("");
					$("li").removeClass("active");
					$("#LiGlobal").addClass("active");
					$("#helpText").html("Here are the global configuration options for WiFi");
				},
			})
			.done(function( data ) {
				getGlobals(0);
				getSupportedGlobals(0);
				$('#BeaconMissTimeoutSlider').slider({
					formatter: function(value) {
						return 'Current value: ' + value;
					}
				});
				$('#fragThresholdSlider').slider({
					formatter: function(value) {
						return 'Current value: ' + value;
					}
				});
				$('#probeDelaySlider').slider({
					formatter: function(value) {
						return 'Current value: ' + value;
					}
				});
				$('#roamPeriodmsSlider').slider({
					formatter: function(value) {
						return 'Current value: ' + value;
					}
				});
				$('#roamTriggerSlider').slider({
					formatter: function(value) {
						return 'Current value: -' + value;
					}
				});
				$('#RTSThresholdSlider').slider({
					formatter: function(value) {
						return 'Current value: ' + value;
					}
				});
				$('#scanDFSTimeSlider').slider({
					formatter: function(value) {
						return 'Current value: ' + value;
					}
				});
				//https://github.com/seiyria/bootstrap-slider/issues/523
				setTimeout(function() {
					$('#BeaconMissTimeoutSlider').slider("relayout");
					$('#fragThresholdSlider').slider("relayout");
					$('#probeDelaySlider').slider("relayout");
					$('#roamPeriodmsSlider').slider("relayout");
					$('#roamTriggerSlider').slider("relayout");
					$('#RTSThresholdSlider').slider("relayout");
					$('#scanDFSTimeSlider').slider("relayout");
				}, 500);
			})
			.fail(function() {
				console.log("Error, couldn't get getGlobals.html.. retrying");
				if (retry < 5){
					retry++;
					clickGlobalsPage(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function submitGlobals(retry){
			var totalAChannelValue = 0;
			AchannelArray = [36,40,44,48,52,56,60,64,100,104,108,112,116,120,124,128,132,136,140,149,153,157,161,165];
			for (var channel in AchannelArray){
				if(document.getElementById('channel' + AchannelArray[channel]).checked){
					totalAChannelValue += parseInt(document.getElementById('channel' + AchannelArray[channel]).value);
				}
			}
			var totalBGChannelValue = 0;
			for (j = 1; j <= 14; j++){
				if(document.getElementById('channel' + j).checked){
					totalBGChannelValue += parseInt(document.getElementById('channel' + j).value);
				}
			}
			var globalData = {
				aLRS: totalAChannelValue,
				authServerType: document.getElementById("authServerType").value,
				bLRS: totalBGChannelValue,
				BeaconMissTimeout: parseInt($('#BeaconMissTimeoutSlider').val()),
				BTcoexist: document.getElementById("BTcoexist").value,
				CCXfeatures: document.getElementById("CCXfeatures").value,
				certPath: document.getElementById("certPath").value,
// 				suppInfo: document.getElementById("suppInfo").value,
				defAdhocChannel: document.getElementById("defAdhocChannel").value,
				DFSchannels: document.getElementById("DFSchannels").value,
				fragThreshold: parseInt($('#fragThresholdSlider').val()),
				PMKcaching: document.getElementById("PMKcaching").value,
				probeDelay: parseInt($('#probeDelaySlider').val()),
				regDomain: document.getElementById("regDomain").value,
				roamPeriodms: parseInt($('#roamPeriodmsSlider').val()),
				roamTrigger: parseInt($('#roamTriggerSlider').val()),
				RTSThreshold: parseInt($('#RTSThresholdSlider').val()),
				scanDFSTime: parseInt($('#scanDFSTimeSlider').val()),
				TTLSInnerMethod: document.getElementById("TTLSInnerMethod").value,
				uAPSD: document.getElementById("uAPSD").value,
				WMEenabled: document.getElementById("WMEenabled").value,
				suppInfoDateCheck: document.getElementById("suppInfoDateCheck").value,
				fips: document.getElementById("fips").value,
			}
			console.log(globalData);
			$.ajax({
				url: "php/setGlobals.php",
				type: "POST",
				data: JSON.stringify(globalData),
				contentType: "application/json",
			})
			.done(function( msg ) {
				console.log(msg);
				SDCERRtoString(msg.SDCERR);
				$("#submitButton").addClass("disabled");
			})
			.fail(function() {
				console.log("Failed to send global data, retrying");
				if (retry < 5){
					retry++;
					submitGlobals(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}
		function scanToProfile(){
			var profileName = document.getElementById("profileName").value;
			selectedProfile(profileName,0);
		}

		function addScanProfile(){
			var newProfile = {
				profileName: document.getElementById("profileName").value,
				SSID: document.getElementById("newSSID").value,
				wepType: document.getElementById("security").value,
			}
			if (newProfile.profileName == ""){
				$("#profileNameDisplay").addClass("has-error");
				$("#profileName").popover({content:'Please enter profile name',placement:'bottom'});
				$("#profileName").popover('show')
				return;
			}
			$.ajax({
				url: "php/addProfile.php",
				type: "POST",
				data: JSON.stringify(newProfile),
				contentType: "application/json",
			})
			.done(function( msg ) {
				console.log(msg);
				console.log(msg.SDCERR);
				SDCERRtoString(msg.SDCERR);
				if (document.getElementById("returnData").innerHTML == "Success"){
					$("#goToProfileDisplay").removeClass("hidden");
				}
			});
		}

		function allowDrop(ev){
			ev.preventDefault();
		}

		function drag(ev){
			var table = document.getElementById("scanTable");
			var index = $(ev.currentTarget).index() + 1;
			if (index > 1){
				ev.dataTransfer.setData("ssid", table.rows[index].cells[0].innerHTML);
				var securityArray = table.rows[index].cells[4].innerHTML.split(",");
				ev.dataTransfer.setData("security",securityArray[0]);
			}
		}

		function drop(ev){
			ev.preventDefault();
			var table = document.getElementById("addTable");
			document.getElementById("newSSID").value = ev.dataTransfer.getData("ssid");
			document.getElementById("security").value = ev.dataTransfer.getData("security");
			$("#profileNameDisplay").removeClass("has-error");
			$("#addScanDisplay").removeClass("hidden");
		}

		function getScan(retry){
			$.ajax({
				url: "php/scan.php",
				type: "POST",
				contentType: "application/json",
			})
			.done(function(msg) {
				if (intervalId){
					clearInterval(intervalId);
					intervalId = 0;
				}
				var table = document.getElementById("scanTable");
				for (var scanItem in msg["scanList"]){
					var row = table.insertRow(-1);
					row.setAttribute('draggable', true);
					row.setAttribute('ondragstart', 'drag(event)');
					var cell0 = row.insertCell(0);
					var cell1 = row.insertCell(1);
					var cell2 = row.insertCell(2);
					var cell3 = row.insertCell(3);
					var cell4 = row.insertCell(4);
					cell0.innerHTML = msg["scanList"][scanItem].SSID;
					cell1.innerHTML = msg["scanList"][scanItem].BSSID;
					cell2.innerHTML = msg["scanList"][scanItem].channel;
					cell3.innerHTML = msg["scanList"][scanItem].RSSI;
					cell4.innerHTML = msg["scanList"][scanItem].security;
				}
				$("#updateProgressDisplay").addClass("hidden");
				$("#scanTableDisplay").removeClass("hidden");
			})
			.fail(function() {
				console.log("Error, couldn't get scan.php.. retrying");
				if (retry < 5){
					retry++;
					getScan(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function clickScanPage(retry){
			$.ajax({
				url: "html/scan.html",
				data: {},
				type: "GET",
				dataType: "html",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
					$('#main_section').html(data);
					$("#returnData").removeClass();
					$("#returnData").html("");
					$("li").removeClass("active");
					$("#LiScan").addClass("active");
					$("#helpText").html("Scan for wireless networks");
				},
			})
			.done(function( data ) {
				getScan(0);
			})
			.fail(function() {
				console.log("Error, couldn't get scan.html.. retrying");
				if (retry < 5){
					retry++;
					clickScanPage(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function uploadCert(retry){
			var file_data = $('#fileToUpload').prop('files')[0];
			var form_data = new FormData();
			form_data.append('file', file_data);
			$.ajax({
				url: 'php/upload.php', // point to server-side PHP script
				cache: false,
				contentType: false,
				processData: false,
				data: form_data,
				type: 'POST',
			})
			.done(function( data ) {
				console.log(data);
				SDCERRtoString(data.SDCERR);
			})
		}

		function submitAdvanced(retry){
			var AdvancedData = {
				suppDebugLevel: parseInt(document.getElementById("suppDebugLevel").value),
				driverDebugLevel: parseInt(document.getElementById("driverDebugLevel").value),
			}
			$.ajax({
				url: "php/setAdvanced.php",
				type: "POST",
				data: JSON.stringify(AdvancedData),
				contentType: "application/json",
			})
			.done(function( msg ) {
				SDCERRtoString(msg.SDCERR);
				$("#submitButton").addClass("disabled");
			})
			.fail(function() {
				console.log("Failed to send advanced data, retrying");
				if (retry < 5){
					retry++;
					submitAdvanced(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function getAdvanced(retry){
			$.ajax({
				url: "php/getAdvanced.php",
				type: "POST",
				contentType: "application/json",
			})
			.done(function(msg) {
				if (intervalId){
					clearInterval(intervalId);
					intervalId = 0;
				}
				console.log(msg);
				document.getElementById("suppDebugLevel").value = msg.suppDebugLevel;
				document.getElementById("driverDebugLevel").value = msg.driverDebugLevel;
			})
			.fail(function() {
				console.log("Error, couldn't get getAdvanced.php.. retrying");
				if (retry < 5){
					retry++;
					getAdvanced(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function clickAdvancedPage(retry){
			$.ajax({
				url: "html/advanced.html",
				data: {},
				type: "GET",
				dataType: "html",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
					$('#main_section').html(data);
					$("#returnData").removeClass();
					$("#returnData").html("");
					$("li").removeClass("active");
					$("#LiAdvanced").addClass("active");
					$("#helpText").html("Advanced configuration options");
				},
			})
			.done(function( data ) {
				$('input[type=file]').bootstrapFileInput();
				$('.file-inputs').bootstrapFileInput();
				getAdvanced(0);
			})
			.fail(function() {
				console.log("Error, couldn't get advanced.html.. retrying");
				if (retry < 5){
					retry++;
					clickAdvancedPage(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function restartUpdate(retry){
			$.ajax({
				url: "php/restartUpdate.php",
				type: "POST",
				contentType: "application/json",
			})
			.done(function( msg ) {
				clickAdvancedRemoteUpdate(0)
			})
			.fail(function() {
				console.log("Failed to restart update, retrying");
				if (retry < 5){
					retry++;
					restartUpdate(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function rebootDevice(retry){
			$.ajax({
				url: "php/reboot.php",
				type: "POST",
				contentType: "application/json",
			})
			.done(function( msg ) {
				$("#updateLogDisplay").addClass("hidden");
				$("#updateLogTextDisplay").addClass("hidden");
				$("#updateProgressDisplay").removeClass("hidden");
				$("#helpText").html("Device is now rebooting. The page will attempt to redirect in 20 seconds if IP address remains the same.");
				setTimeout("location.reload(true);", 20000);
			})
			.fail(function() {
				console.log("Failed to reboot device, retrying");
				if (retry < 5){
					retry++;
					rebootDevice(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function startUpdate(retry){
			var updateData = {
				remoteUpdate: document.getElementById("remoteUpdate").value,
			}
			console.log(updateData);
			$.ajax({
				url: "php/startUpdate.php",
				type: "POST",
				data: JSON.stringify(updateData),
				contentType: "application/json",
			})
			.done(function( msg ) {
				checkUpdateStarted(0);
			})
			.fail(function() {
				console.log("Failed to send update data, retrying");
				if (retry < 5){
					retry++;
					startUpdate(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function showUpdateLog(retry){
			$.ajax({
				url: "php/getUpdateLog.php",
				type: "POST",
				contentType: "application/json",
			})
			.done(function( data ) {
				var logLength = Object.keys(data.log).length;
				document.getElementById("updateLogText").rows = logLength + 3;
				$("#updateProgressDisplay").addClass("hidden");
				$("#updateLogDisplay").removeClass("hidden");
				$("#updateLogTextDisplay").removeClass("hidden");
				$("#updateLogText").html(data.log);
				if (data.log[logLength - 1].trim() == "Done."){
					if (intervalId){
							clearInterval(intervalId);
							intervalId = 0;
					}
					if (data.log[logLength - 2].trim().substring(0,7) == "Errors:"){
						$("#startOverButtonDisplay").removeClass("hidden");
					}else{
						$("#rebootButtonDisplay").removeClass("hidden");
					}
				}else{
					if (!intervalId){
						setIntervalUpdate(showUpdateLog);
					}
				}
			})
			.fail(function() {
				console.log("Error, couldn't get update log..");
				if (retry < 5){
					retry++;
					clickAdvancedRemoteUpdate(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function checkUpdateStarted(retry){
			$.ajax({
				url: "php/verifyUpdate.php",
				type: "POST",
				contentType: "application/json",
			})
			.done(function( data ) {
				if (data.fwUpdate == "running"){
					$("#remoteUpdateDisplay").addClass("hidden");
					$("#submitButton").addClass("hidden");
					showUpdateLog(0);
				}else{
					$("#updateProgressDisplay").addClass("hidden");
					$("#remoteUpdateDisplay").removeClass("hidden");
					$("#submitButton").removeClass("hidden");
				}
			})
			.fail(function() {
				console.log("Error, couldn't get verifyUpdate.php.. retrying");
				if (retry < 5){
					retry++;
					checkUpdateStarted(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function clickAdvancedRemoteUpdate(retry){
			$.ajax({
				url: "html/remoteUpdate.html",
				data: {},
				type: "GET",
				dataType: "html",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
					$('#main_section').html(data);
					$("#returnData").removeClass();
					$("#returnData").html("");
					$("li").removeClass("active");
					$("#submenuRemoteUpdate").addClass("active");
					$("#helpText").html("Remotely update device");
				},
			})
			.done(function( data ) {
				checkUpdateStarted(0);
			})
			.fail(function() {
				console.log("Error, couldn't get remoteUpdate.html.. retrying");
				if (retry < 5){
					retry++;
					clickAdvancedRemoteUpdate(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function modifyInterface(option,retry){
			var InterfaceSelect = document.getElementById("InterfaceSelect");
			var InterfaceData = {
				interfaceName: document.getElementById("newInterfaceName").value,
				option: option,
			}
			if (option == "remove"){
				InterfaceData.interfaceName = InterfaceSelect.value;
			}
			if (InterfaceData.interfaceName != ""){
				$.ajax({
					url: "php/setInterfaces.php",
					type: "POST",
					data: JSON.stringify(InterfaceData),
					contentType: "application/json",
				})
				.done(function( msg ) {
					console.log(msg);
					SDCERRtoString(msg.SDCERR);
					if (document.getElementById("returnData").innerHTML == "Success"){
						if (option == "add"){
							$("#newInterfaceNameDisplay").addClass("hidden");
							var newOption = document.createElement("option");
							newOption.text = InterfaceData.interfaceName;
							InterfaceSelect.add(newOption);
							InterfaceSelect.size = InterfaceSelect.size + 1;
						} else if (option == "remove"){
							for(var i = 0; i < InterfaceSelect.options.length; i++) {
								if (InterfaceData.interfaceName == InterfaceSelect.options[i].text){
									InterfaceSelect.options.remove(i);
									InterfaceSelect.size = InterfaceSelect.size - 1;
								}
							}
						}
					}
				})
				.fail(function() {
					console.log("Failed to set interface data, retrying");
					if (retry < 5){
						retry++;
						modifyInterface(option,retry)
					} else {
						console.log("Retry max attempt reached");
					}
				});
			}
		}

		function showAddInterface(){
			$("#newInterfaceNameDisplay").removeClass("hidden");
		}

		function submitInterface(retry){
			var InterfaceData = {
				interfaceName: document.getElementById("interfaceName").value,
				auto: document.getElementById("auto").value,
				method: document.getElementById("method").value,
				br_port_1: document.getElementById("br_port_1").value,
				br_port_2: document.getElementById("br_port_2").value,
				address: document.getElementById("address").value,
				netmask: document.getElementById("netmask").value,
				gateway: document.getElementById("gateway").value,
				broadcast: document.getElementById("broadcast").value,
				nameserver: document.getElementById("nameserver").value,
			}
			console.log(InterfaceData);
			$.ajax({
				url: "php/setInterfaces.php",
				type: "POST",
				data: JSON.stringify(InterfaceData),
				contentType: "application/json",
			})
			.done(function( msg ) {
				console.log(msg);
				SDCERRtoString(msg.SDCERR);
				$("#submitButton").addClass("disabled");
			})
			.fail(function() {
				console.log("Failed to set interface data, retrying");
				if (retry < 5){
					retry++;
					submitInterface(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function updateGetInterfacePage(interfaceName,retry){
			$.ajax({
				url: "php/getInterfaces.php",
				type: "POST",
				contentType: "application/json",
			})
			.done(function( data ) {
				for (var iface in data.Interfaces){
					if (iface == interfaceName){
						document.getElementById("interfaceName").value = iface;
						if (data.AutoInterfaces[iface]){
							document.getElementById("auto").selectedIndex = 1;
						}
						switch (data.Interfaces[iface].inet){
							case "dhcp":
								document.getElementById("method").selectedIndex = 0;
								break;
							case "static":
								document.getElementById("method").selectedIndex = 1;
								break;
							case "manual":
								document.getElementById("method").selectedIndex = 2;
								break;
							default:
								$("#methodDisplay").addClass("hidden");
								break;
						}
						if (data.Interfaces[iface].br_port_1 && data.Interfaces[iface].br_port_2){
							$("#br_port_1_Display").removeClass("hidden");
							$("#br_port_2_Display").removeClass("hidden");
							var x = document.getElementById("br_port_1");
							x.size = Object.keys(data.AutoInterfaces).length;
							var y = document.getElementById("br_port_2");
							y.size = Object.keys(data.AutoInterfaces).length;
							for (var Autoiface in data.AutoInterfaces) {
								var br_port_1 = document.createElement("option");
								var br_port_2 = document.createElement("option");
								br_port_1.text = Autoiface;
								br_port_2.text = Autoiface;
								x.add(br_port_1);
								y.add(br_port_2);
								if (br_port_1.text == data.Interfaces[iface].br_port_1){
									x.selectedIndex = br_port_1.index;
								}
								if (br_port_2.text == data.Interfaces[iface].br_port_2){
									y.selectedIndex = br_port_2.index;
								}
							}
						}
						if (data.Interfaces[iface].address){
							document.getElementById("address").value = data.Interfaces[iface].address;
						}
						if (data.Interfaces[iface].netmask){
							document.getElementById("netmask").value = data.Interfaces[iface].netmask;
						}
						if (data.Interfaces[iface].gateway){
							document.getElementById("gateway").value = data.Interfaces[iface].gateway;
						}
						if (data.Interfaces[iface].broadcast){
							document.getElementById("broadcast").value = data.Interfaces[iface].broadcast;
						}
						if (data.Interfaces[iface].nameserver){
							document.getElementById("nameserver").value = data.Interfaces[iface].nameserver;
						}
					}
				}
			})
			.fail(function() {
				console.log("Failed to get interface data, retrying");
				if (retry < 5){
					retry++;
					updateGetInterfacePage(interfaceName,retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function selectedInterface(retry){
			var selectedInterface = document.getElementById("InterfaceSelect").value;
			if (!selectedInterface){
				return;
			}
			$.ajax({
				url: "html/getInterface.html",
				data: {},
				type: "GET",
				dataType: "html",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
					$('#main_section').html(data);
					$("#returnData").removeClass();
					$("#returnData").html("");
					$("#helpText").html("Adjust interface settings.");
				},
				error: function (xhr, status) {
					console.log("Error, couldn't get getInterface.html");
				},
			})
			.done(function( msg ) {
				console.log("Now try to get interface from PHP");
				updateGetInterfacePage(selectedInterface,0);
			})
			.fail(function() {
				console.log("Failed to get get interface, retrying");
				if (retry < 5){
					retry++;
					selectedInterface(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function updateSelectInterfacePage(retry){
			$.ajax({
				url: "php/getInterfaces.php",
				data: {},
				type: "POST",
				contentType: "application/json",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
				},
			})
			.done(function( data ) {
				var x = document.getElementById("InterfaceSelect");
				x.size = Object.keys(data.Interfaces).length;
				for (var iface in data.Interfaces) {
					var option = document.createElement("option");
					option.text = iface;
					x.add(option);
				}
			})
			.fail(function() {
				console.log("Error, couldn't get getInterfaces.php.. retrying");
				if (retry < 5){
					retry++;
					updateSelectInterfacePage(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function clickInterfacePage(retry){
			$.ajax({
				url: "html/selectInterface.html",
				data: {},
				type: "GET",
				dataType: "html",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
					$('#main_section').html(data);
					$("#returnData").removeClass();
					$("#returnData").html("");
					$("li").removeClass("active");
					$("#LiInterface").addClass("active");
					$("#helpText").html("Interface information");
				},
			})
			.done(function( data ) {
				updateSelectInterfacePage(0);
			})
			.fail(function() {
				console.log("Error, couldn't get getInterfaces.php.. retrying");
				if (retry < 5){
					retry++;
					clickInterfacePage(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function getVersion(retry){
			$.ajax({
				url: "php/version.php",
				type: "POST",
				contentType: "application/json",
			})
			.done(function(msg) {
				if (intervalId){
					clearInterval(intervalId);
					intervalId = 0;
				}
				console.log(msg);
				document.getElementById("sdk").innerHTML = msg.sdk;
				document.getElementById("chipset").innerHTML = msg.chipset;
				document.getElementById("driver").innerHTML = msg.driver;
				document.getElementById("firmware").innerHTML = msg.firmware;
				document.getElementById("supplicant").innerHTML = msg.supplicant;
				document.getElementById("php_sdk").innerHTML = msg.php_sdk;
				document.getElementById("build").innerHTML = msg.build;
			})
			.fail(function() {
				console.log("Error, couldn't get version.php.. retrying");
				if (retry < 5){
					retry++;
					getVersion(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}

		function clickVersionPage(retry){
			$.ajax({
				url: "html/version.html",
				data: {},
				type: "GET",
				dataType: "html",
				success: function (data) {
					if (intervalId){
						clearInterval(intervalId);
						intervalId = 0;
					}
					$('#main_section').html(data);
					$("#returnData").removeClass();
					$("#returnData").html("");
					$("li").removeClass("active");
					$("#LiVersion").addClass("active");
					$("#helpText").html("System version information");
				},
			})
			.done(function( data ) {
				getVersion(0);
			})
			.fail(function() {
				console.log("Error, couldn't get version.html.. retrying");
				if (retry < 5){
					retry++;
					clickGlobalsPage(retry);
				} else {
					console.log("Retry max attempt reached");
				}
			});
		}
		</script>

	</head>

	<body>
		<nav class="navbar navbar-inverse navbar-fixed-top">
			<div class="container-fluid">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
						<span class="sr-only">Toggle navigation</span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">WebLCM</a>
				</div>
				<div id="navbar" class="navbar-collapse collapse">
					<ul class="nav navbar-nav navbar-right">
						<li><a href="#">Dashboard</a></li>
						<li><a href="#">Settings</a></li>
					</ul>
				</div>
			</div>
		</nav>

		<div class="container-fluid">
			<div class="row">
				<div class="col-xs-3 col-sm-3 col-md-2 sidebar">
					<ul class="nav nav-sidebar">
						<li id="LiStatus" class="active"><a onclick="clickStatusPage()" href="#">WiFi Status <span class="sr-only">(current)</span></a></li>
						<li id="LiProfile"><a href="#" data-toggle="collapse" data-target="#submenu1" aria-expanded="false">WiFi Profiles </a></li>
							<ul class="nav nav-submenu collapse in" id="submenu1" role="menu" aria-labelledby="LiProfile">
								<li id="submenuEdit"><a href="#" onclick="clickProfileEditPage(0)">Edit Profiles</a></li>
								<li id="submenuAdd"><a href="#" onclick="clickAddProfilePage(0)">Add profile</a></li>
							</ul>
						<li id="LiGlobal"><a href="#" onclick="clickGlobalsPage(0)">WiFi Globals</a></li>
						<li id="LiScan" onclick="clickScanPage(0)"><a href="#">WiFi Scan</a></li>
						<li id="LiAdvanced" onclick="clickAdvancedPage(0)" data-toggle="collapse" data-target="#submenu2" aria-expanded="true"><a href="#">WiFi Advanced</a></li>
							<ul class="nav nav-submenu collapse" id="submenu2" role="menu" aria-labelledby="LiAdvanced">
								<li id="submenuRemoteUpdate"><a href="#" onclick="clickAdvancedRemoteUpdate(0)">Remote Update</a></li>
							</ul>
					</ul>
					<ul class="nav nav-sidebar">
						<li id="LiInterface" onclick="clickInterfacePage(0)"><a href="#">Interface Configuration</a></li>
						<li id="LiVersion" onclick="clickVersionPage(0)"><a href="#">System Version</a></li>
					</ul>
				</div>
				<div class="col-xs-9 col-xs-offset-3 col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
					<div class="row placeholders">
						<div class="col-xs-12 col-sm-6 placeholder">
							<p id="main_section"></p>
						</div>
						<div id="helpSection" class="col-xs-0 col-sm-6 hidden-xs hidden-sm placeholder">
							<div id="returnData" class="" role="alert"></div>
							<img src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" width="200" height="200" class="img-responsive" alt="Generic placeholder thumbnail">
							<h4>Need help?</h4>
							<span id="helpText" class="text-muted">This page shows the current state of WiFi</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
